select <- order(rv, decreasing = TRUE)[seq_len(min(1000,
length(rv)))]
pca_res <- prcomp(x = t(vst_dds[select, ]), rank. = 6)
pca_df <- as.data.frame(pca_res$x)
vst_dds
sampletable$Age_group <- NA
sampletable$Age_group <- cut(sampletable$Age, 4, labels = FALSE)
dds <- DESeqDataSetFromMatrix(countData = counts_table,
colData = sampletable,
design = ~ Group)
#rm(counts_table)
dds$Age_group <- factor(dds$Age_group, c(1,2,3,4))
dds$Group <- relevel(dds$Group, ref ="T0_control")
dds2 <- estimateSizeFactors(dds)
counts(dds2, normalized=TRUE)
#counts_norm <- counts(dds2, normalized=TRUE)
#dds2 <- DESeq(dds)
vst_dds2 <- assay(vst(dds2, blind=TRUE))
vst_3d_2 <- vst(dds2, blind=TRUE)
vst_dds == vst_dds2
table(vst_dds == vst_dds2)
rm(dds2)
dds2 <- DESeq(dds)
vst_dds2 <- assay(vst(dds2, blind=TRUE))
vst_3d_2 <- vst(dds2, blind=TRUE)
table(vst_dds == vst_dds2)
library(tidyverse)
library(stats)
library(factoextra)
library(ggfortify)
library(DESeq2)
library(btools)
library(RColorBrewer)
library(pheatmap)
sampletable <- read.table("../../Additional_data/samplesheet.tsv", header=T, sep="\t")
counts_table <- read.table("/home/ultramind/Disco2/SARS_sRNA_paper/Reproducibility_test/Results/03-Fusion_tables/Filtered_abs-outer_filt5.tsv",  header=T, sep="\t")
counts_table <- counts_table %>%
column_to_rownames(var="seq")
sampletable$Age_group <- NA
sampletable$Age_group <- cut(sampletable$Age, 4, labels = FALSE)
dds <- DESeqDataSetFromMatrix(countData = counts_table,
colData = sampletable,
design = ~ Group)
#rm(counts_table)
dds$Age_group <- factor(dds$Age_group, c(1,2,3,4))
dds$Group <- relevel(dds$Group, ref ="T0_control")
#dds2 <- estimateSizeFactors(dds)
#counts_norm <- counts(dds2, normalized=TRUE)
dds2 <- DESeq(dds)
vst_dds2 <- assay(vst(dds2, blind=TRUE))
vst_3d_2 <- vst(dds2, blind=TRUE)
# Sin usar DESeq()
vst_dds <- assay(vst(dds, blind=TRUE))
vst_3d <- vst(dds, blind=TRUE)
# As we are now working with the outer table, one way to filter the rows is
# to work only with those N sequences with highest row variance. Such as they
# do in DESeq2::plotPCA.
rv <- rowVars(vst_dds)
select <- order(rv, decreasing = TRUE)[seq_len(min(1000,
length(rv)))]
pca_res <- prcomp(x = t(vst_dds[select, ]), rank. = 6)
pca_df <- as.data.frame(pca_res$x)
table(vst_dds == vst_dds2)
counts_norm <- counts(dds2, normalized=TRUE)
View(counts_norm)
View(counts_table)
View(counts_norm)
sizeFactors(dds2)
colSums(counts(dds2,normalized=T))
colSums(counts(dds2))
sizeFactors(DDS2)
sizeFactors(dds2)
library("DESeq2")
library("ggplot2")
library("tidyverse")
counts_table_final <- read.table("/home/ultramind/Disco2/SARS_sRNA_paper/Reproducibility_test/Results/03-Fusion_tables/Filtered_abs-outer_filt5.tsv", sep="\t")
dds <- DESeqDataSetFromMatrix(countData = counts_table_final,
colData = sampletable,
design = ~ Group)
counts_table_final <- counts_table_final %>%
column_to_rownames(var="seq")
View(counts_table_final)
counts_table_final <- read.table("/home/ultramind/Disco2/SARS_sRNA_paper/Reproducibility_test/Results/03-Fusion_tables/Filtered_abs-outer_filt5.tsv", sep="\t",
header=TRUE)
counts_table_final <- counts_table_final %>%
column_to_rownames(var="seq")
dds <- DESeqDataSetFromMatrix(countData = counts_table_final,
colData = sampletable,
design = ~ Group)
dds$Group <- relevel(dds$Group, ref ="T0_control")
View(dds)
library("DESeq2")
library("ggplot2")
library("tidyverse")
counts_table_final <- read.table("/home/ultramind/Disco2/SARS_sRNA_paper/Reproducibility_test/Results/03-Fusion_tables/Filtered_abs-outer_filt5.tsv", sep="\t",
header=TRUE)
counts_table_final <- counts_table_final %>%
column_to_rownames(var="seq")
dds <- DESeqDataSetFromMatrix(countData = counts_table_final,
colData = sampletable,
design = ~ Group)
sampletable <- read.table("../../Additional_data/samplesheet.tsv", header=T, sep="\t")
rownames(sampletable) <- sampletable$SampleName
View(sampletable)
dds <- DESeqDataSetFromMatrix(countData = counts_table_final,
colData = sampletable,
design = ~ Group)
View(counts_table_final)
colnames(counts_table_final) <- gsub("\\.", "-", colnames(counts_table_final))
sampletable <- read.table("../../Additional_data/samplesheet.tsv", header=T, sep="\t")
rownames(sampletable) <- sampletable$SampleName
dds <- DESeqDataSetFromMatrix(countData = counts_table_final,
colData = sampletable,
design = ~ Group)
dds$Group <- relevel(dds$Group, ref ="T0_control")
dds_2 <- DESeq(dds)
save(dds_2, file = "/path/to/DEA_results/DESeq_object.RData")
padj.cutoff <- 0.05
res_T1acute <- results(dds_2, name ="Group_T1_acute_vs_T0_control", lfcThreshold = 0.585, alpha=0.05)
shrunk_T1acute <- lfcShrink(dds_2, coef="Group_T1_acute_vs_T0_control", res=res_T1acute)
res_T1acute_tb <- res_T1acute %>%
data.frame() %>%
rownames_to_column(var="seq") %>%
as_tibble()
res_T1acute_tb$lfcShrunk <- shrunk_T1acute$log2FoldChange
res_T1acute_tb$lfcShrunkSE <- shrunk_T1acute$lfcSE
sigT1acute <- res_T1acute_tb %>%
dplyr::filter(padj < padj.cutoff)
#write.table(res_T1acute_tb, "/path/to/DEA_results/results_DE_T1acute.tsv", sep = "\t", quote = F, row.names = F)
View(res_T1acute)
View(res_T1acute_tb)
shrunk_T1acute
res_T1acute_tb
padj.cutoff <- 0.05
res_T2test <- results(dds_2, name ="Group_T2_acute_vs_T0_control", lfcThreshold = 0.585, alpha=0.05)
shrunk_T2acute <- lfcShrink(dds_2, coef="Group_T2_acute_vs_T0_control", res=res_T1acute)
padj.cutoff <- 0.05
res_T2test <- results(dds_2, name ="Group_T2_acute_vs_T0_control", lfcThreshold = 0.585, alpha=0.05)
shrunk_T2acute <- lfcShrink(dds_2, coef="Group_T2_acute_vs_T0_control", res=res_T2acute)
padj.cutoff <- 0.05
res_T2test <- results(dds_2, name ="Group_T2_acute_vs_T0_control", lfcThreshold = 0.585, alpha=0.05)
shrunk_T2test <- lfcShrink(dds_2, coef="Group_T2_acute_vs_T0_control", res=res_T2test)
res_T2test_tb <- res_T2test %>%
data.frame() %>%
rownames_to_column(var="seq") %>%
as_tibble()
res_T2test_tb$lfcShrunk <- shrunk_T2test$log2FoldChange
res_T2test_tb$lfcShrunkSE <- shrunk_T2test$lfcSE
sigT2test <- res_T2test_tb %>%
dplyr::filter(padj < padj.cutoff)
#write.table(res_T1acute_tb, "/path/to/DEA_results/results_DE_T1acute.tsv", sep = "\t", quote = F, row.names = F)
MAplot(res_T2test)
plotMA(res_T2test)
anno_file <- read.table("/home/ultramind/Disco2/SARS_sRNA_paper/Reproducibility_test/Results/06-Annotation/Annotation/curated_unitas_withtiny_annotation.tsv", sep="\t", header = TRUE)
cfg_file <- read.delim("/home/ultramind/Disco2/SARS_sRNA_paper/Reproducibility_test/Results/06-Annotation/Exogenous/centrifuge_anno_final.tsv", sep="\t", header=TRUE)
View(counts_table_final)
counts_table_final <- read.table("/home/ultramind/Disco2/SARS_sRNA_paper/Reproducibility_test/Results/03-Fusion_tables/Filtered_abs-outer_filt5.tsv", sep="\t",
header=TRUE)
counts_table_final <- counts_table_final %>%
column_to_rownames(var="seq")
colnames(counts_table_final) <- gsub("\\.", "-", colnames(counts_table_final))
colnames(counts_table_final) <- gsub("T0_control", "C", colnames(counts_table_final))
colnames(counts_table_final) <- gsub("T1_acute", "A1", colnames(counts_table_final))
colnames(counts_table_final) <- gsub("T2_acute", "A2", colnames(counts_table_final))
colnames(counts_table_final) <- gsub("T1_mild", "M1", colnames(counts_table_final))
colnames(counts_table_final) <- gsub("T2_mild", "M2", colnames(counts_table_final))
sampletable <- read.table("../../Additional_data/samplesheet_test.tsv", header=T, sep="\t")
counts_table_final <- read.table("/home/ultramind/Disco2/SARS_sRNA_paper/Reproducibility_test/Results/03-Fusion_tables/Filtered_abs-outer_filt5.tsv", sep="\t",
header=TRUE)
counts_table_final <- counts_table_final %>%
column_to_rownames(var="seq")
colnames(counts_table_final) <- gsub("\\.", "-", colnames(counts_table_final))
colnames(counts_table_final) <- gsub("T0_control", "C", colnames(counts_table_final))
colnames(counts_table_final) <- gsub("T1_acute", "A1", colnames(counts_table_final))
colnames(counts_table_final) <- gsub("T2_acute", "A2", colnames(counts_table_final))
colnames(counts_table_final) <- gsub("T1_mild", "M1", colnames(counts_table_final))
colnames(counts_table_final) <- gsub("T2_mild", "M2", colnames(counts_table_final))
sampletable <- read.table("../../Additional_data/samplesheet_test.tsv", header=T, sep="\t")
counts_table_final <- read.table("/home/ultramind/Disco2/SARS_sRNA_paper/Reproducibility_test/Results/03-Fusion_tables/Filtered_abs-outer_filt5.tsv", sep="\t",
header=TRUE)
counts_table_final <- counts_table_final %>%
column_to_rownames(var="seq")
colnames(counts_table_final) <- gsub("\\.", "-", colnames(counts_table_final))
colnames(counts_table_final) <- gsub("T0_control", "C", colnames(counts_table_final))
colnames(counts_table_final) <- gsub("T1_acute", "A1", colnames(counts_table_final))
colnames(counts_table_final) <- gsub("T2_acute", "A2", colnames(counts_table_final))
colnames(counts_table_final) <- gsub("T1_mild", "M1", colnames(counts_table_final))
colnames(counts_table_final) <- gsub("T2_mild", "M2", colnames(counts_table_final))
sampletable <- read.table("/home/ultramind/Disco2/SARS_sRNA_paper/Reproducibility_test/Additional_data/samplesheet_test.tsv", header=T, sep="\t")
rownames(sampletable) <- sampletable$SampleName
dds <- DESeqDataSetFromMatrix(countData = counts_table_final,
colData = sampletable,
design = ~ Group)
dds$Group <- relevel(dds$Group, ref ="C")
dds_2 <- DESeq(dds)
#save(dds_2, file = "/path/to/DEA_results/DESeq_object.RData")
padj.cutoff <- 0.05
res_T1acute <- results(dds_2, name ="Group_A1_vs_C", lfcThreshold = 0.585, alpha=0.05)
shrunk_T1acute <- lfcShrink(dds_2, coef="Group_A1_vs_C", res=res_T1acute)
res_T1acute_tb <- res_T1acute %>%
data.frame() %>%
rownames_to_column(var="seq") %>%
as_tibble()
res_T1acute_tb$lfcShrunk <- shrunk_T1acute$log2FoldChange
res_T1acute_tb$lfcShrunkSE <- shrunk_T1acute$lfcSE
sigT1acute <- res_T1acute_tb %>%
dplyr::filter(padj < padj.cutoff)
#write.table(res_T1acute_tb, "/path/to/DEA_results/results_DE_T1acute.tsv", sep = "\t", quote = F, row.names = F)
padj.cutoff <- 0.05
res_test <- results(dds_2, name ="Group_A2_vs_C", lfcThreshold = 0.585, alpha=0.05)
shrunk_test <- lfcShrink(dds_2, coef="Group_A2_vs_C", res=res_test)
res_test_tb <- res_test %>%
data.frame() %>%
rownames_to_column(var="seq") %>%
as_tibble()
res_test_tb$lfcShrunk <- shrunk_test$log2FoldChange
res_test_tb$lfcShrunkSE <- shrunk_test$lfcSE
sigtest <- res_test_tb %>%
dplyr::filter(padj < padj.cutoff)
#write.table(res_T1acute_tb, "/path/to/DEA_results/results_DE_T1acute.tsv", sep = "\t", quote = F, row.names = F)
View(sigtest)
plotMA(res_test)
plotMA(shrunk_test)
plotMA(res_test, ylim(-10,10))
plotMA(res_test, ylim=c(-10,10))
plotMA(shrunk_test, ylim=c(-20,20))
DE_test_ann <- merge(res_test_tb, anno_file, by.x = "seq", by.y = "Seq", all.x = TRUE)
DE_test_ann <- merge(DE_test_ann, cfg_file, by.x="seq", by.y="Seq", all.x=TRUE)
DE_test_ann$ID.x <- ifelse(is.na(DE_test_ann$ID.x), DE_test_ann$ID.y, DE_test_ann$ID.x)
DE_test_ann$ID.y <- NULL
names(DE_test_ann)[names(DE_test_ann) == 'ID.x'] <- 'ID'
DE_test_ann$RNA_class <- ifelse(!is.na(DE_test_ann$taxID), "Microorganism", DE_test_ann$RNA_class)
DE_test_ann$Class_toplot <- ifelse(is.na(DE_test_ann$RNA_class), "Other", DE_test_ann$RNA_class)
DE_test_ann$Class_toplot <- ifelse(grepl("miRNA-like|lncRNA|protein_coding|misc_RNA|rRNA|Mt_RNA|scaRNA", DE_test_ann$RNA_class), "Other", DE_test_ann$Class_toplot)
DE_test_ann$Class_toplot <- ifelse(grepl("piR-cluster", DE_test_ann$RNA_class), "piRNA", DE_test_ann$Class_toplot)
DE_test_ann$Class_toplot <- ifelse(DE_test_ann$padj < 0.05, DE_test_ann$Class_toplot, "Non-significant")
DE_test_ann$Class_toplot <- factor(DE_test_ann$Class_toplot, levels=c("miRNA", "tyRNA", "tRNA-derived", "snRNA", "snoRNA", "piRNA", "Microorganism", "Other", "Non-significant"))
# Check how many seqs have an strange trend of lfcShrink correction
DE_test_ann_shrink <- DE_test_ann[abs(DE_test_ann$log2FoldChange) < abs(DE_test_ann$lfcShrunk),] #6703
DE_test_ann_shrink <- DE_test_ann[abs(DE_test_ann$log2FoldChange) < abs(DE_test_ann$lfcShrunk),]
# Check how many seqs have an strange trend of lfcShrink correction
DE_test_ann_shrink <- DE_test_ann[abs(DE_test_ann$log2FoldChange) < abs(DE_test_ann$lfcShrunk),] #6703
# Check if the sign of the LFCs is concordant
table(sign(DE_test_ann$log2FoldChange) == sign(DE_test_ann$lfcShrunk)) #413
DE_test_ann_sign <- DE_test_ann[sign(DE_test_ann$log2FoldChange) != sign(DE_test_ann$lfcShrunk),]
table(DE_test_ann_sign$Class_toplot)
# Get sig sequences
DE_test_ann_sig <- DE_test_ann[DE_test_ann$padj < 0.05,]
# How many with strange trends
DE_test_ann_sig_shrink <- DE_test_ann_sig[abs(DE_test_ann_sig$log2FoldChange) < abs(DE_test_ann_sig$lfcShrunk),]
table(DE_test_ann_sig_shrink$Class_toplot)
# How many with really strange trends
DE_test_ann_sig_extreme <- DE_test_ann_sig[2+abs(DE_test_ann_sig$log2FoldChange) < abs(DE_test_ann_sig$lfcShrunk),]
table(DE_test_ann_sig_extreme$Class_toplot)
# Check if in the case of sdRNAs the sign is respected
DE_T2_acute_ann_sdRNAs <- DE_test_ann_sig[DE_test_ann_sig$Class_toplot == "snoRNA",]
table(sign(DE_T2_acute_ann_sdRNAs$log2FoldChange) == sign(DE_T2_acute_ann_sdRNAs$lfcShrunk))
# How many of the tsRNAs with strange trends are from our groups studied
DE_test_ann_sig_shrink_tsRNA <- DE_test_ann_sig_shrink[DE_test_ann_sig_shrink$Class_toplot == "tRNA-derived",]
table(DE_test_ann_sig_shrink_tsRNA$tRNA_class)
DE_test_ann_sig_extreme_tsRNA <- DE_test_ann_sig_extreme[DE_test_ann_sig_extreme$Class_toplot == "tRNA-derived",]
table(DE_test_ann_sig_extreme_tsRNA$tRNA_class)
# What about the miRNAs
DE_test_ann_sig_shrink_miRNA <- DE_test_ann_sig_shrink[DE_test_ann_sig_shrink$Class_toplot == "miRNA",]
# How many HC?
DE_test_ann_sig_shrink_HC <- DE_test_ann_sig_shrink_miRNA[!grepl("\\(",DE_test_ann_sig_shrink_miRNA$RNA_ID),]
DE_test_ann_sig_extreme_miRNA <- DE_test_ann_sig_extreme[DE_test_ann_sig_extreme$Class_toplot == "miRNA",]
# How many HC?
DE_test_ann_sig_extreme_HC <- DE_test_ann_sig_extreme_miRNA[!grepl("\\(",DE_test_ann_sig_extreme_miRNA$RNA_ID),]
View(DE_test_ann)
# Check if the sign of the LFCs is concordant
table(sign(DE_test_ann$log2FoldChange) == sign(DE_test_ann$lfcShrunk)) #413
DE_test_ann_sign <- DE_test_ann[sign(DE_test_ann$log2FoldChange) != sign(DE_test_ann$lfcShrunk),]
# How many with strange trends
DE_test_ann_sig_shrink <- DE_test_ann_sig[abs(DE_test_ann_sig$log2FoldChange) < abs(DE_test_ann_sig$lfcShrunk),]
table(DE_test_ann_sig_shrink$Class_toplot)
table(DE_test_ann_shrink$Class_toplot)
# How many with strange trends
DE_test_ann_sig_shrink <- DE_test_ann_sig[abs(DE_test_ann_sig$log2FoldChange) < abs(DE_test_ann_sig$lfcShrunk),]
table(DE_test_ann_sig_shrink$Class_toplot)
# How many with really strange trends
DE_test_ann_sig_extreme <- DE_test_ann_sig[2+abs(DE_test_ann_sig$log2FoldChange) < abs(DE_test_ann_sig$lfcShrunk),]
table(DE_test_ann_sig_extreme$Class_toplot)
# Check how many seqs have an strange trend of lfcShrink correction
DE_test_ann_shrink <- DE_test_ann[abs(DE_test_ann$log2FoldChange) < abs(DE_test_ann$lfcShrunk),] #6703
table(DE_test_ann_shrink$Class_toplot)
# Check if the sign of the LFCs is concordant
table(sign(DE_test_ann$log2FoldChange) == sign(DE_test_ann$lfcShrunk)) #413
DE_test_ann_sign <- DE_test_ann[sign(DE_test_ann$log2FoldChange) != sign(DE_test_ann$lfcShrunk),]
table(DE_test_ann_sign$Class_toplot)
# Get sig sequences
DE_test_ann_sig <- DE_test_ann[DE_test_ann$padj < 0.05,]
# How many with strange trends
DE_test_ann_sig_shrink <- DE_test_ann_sig[abs(DE_test_ann_sig$log2FoldChange) < abs(DE_test_ann_sig$lfcShrunk),]
table(DE_test_ann_sig_shrink$Class_toplot)
# How many with really strange trends
DE_test_ann_sig_extreme <- DE_test_ann_sig[2+abs(DE_test_ann_sig$log2FoldChange) < abs(DE_test_ann_sig$lfcShrunk),]
table(DE_test_ann_sig_extreme$Class_toplot)
mean(DE_test_ann_shrink$baseMean)
median(DE_test_ann_shrink$baseMean)
hist(DE_test_ann$baseMean)
hist(DE_test_ann_shrinkbaseMean)
hist(DE_test_ann_shrink$baseMean)
mean(DE_test_ann_shrink$baseMean)
View(DE_test_ann_shrink)
?plotCounts
plotCounts(dds_2, gene="TCCCTGGTGGTCTAGTGGTTAGGATTCGGCGCG")
plotCounts(dds_2, gene="TCCCTGGTGGTCTAGTGGTTAGGATTCGGCGCG", intgroup = c("C", "A1", "A2", "M1", "M2"))
plotCounts(dds_2, gene="TCCCTGGTGGTCTAGTGGTTAGGATTCGGCGCG", intgroup = "Group")
plotCounts(dds_2, gene="AGGACGGTGGCCATGGAAGTCGG", intgroup = "Group")
View(DE_test_ann_sig_extreme)
plotCounts(dds_2, gene="AGGACGGTGGCCATGGAAGTCGG", intgroup = "Group")
plotCounts(dds_2, gene="GCCGGCTTAGCTCAGTTGGTAGAGCATCTG", intgroup = "Group")
table(DE_test_ann_shrink$Class_toplot)
# How many with really strange trends
DE_test_ann_shrink_ext <- DE_test_ann[2+abs(DE_test_ann$log2FoldChange) < abs(DE_test_ann$lfcShrunk),] #6703
table(DE_test_ann_shrink_ext$Class_toplot)
View(DE_test_ann_shrink_ext)
plotCounts(dds_2, gene="GAAGGGAGCTTGACTGCGAGACGG", intgroup = "Group")
plotCounts(dds_2, gene="GAAGGGAGCTTGACTGCGAGACGGA", intgroup = "Group")
plotCounts(dds_2, gene="GGGGGCGTAGCTCAGTTGGGAGAGCACG", intgroup = "Group")
plotCounts(dds_2, gene="TTTGGCAATGGTAGAACTCACACT", intgroup = "Group")
plotCounts(dds_2, gene="GAAGGGAGCTTGACTGCGAGACGG", intgroup = "Group")
plotCounts(dds_2, gene="CGGGCTGTGGCGCAGTT", intgroup = "Group")
plotCounts(dds_2, gene="AGAAGGGAGCTTGACTGCGAGACGGA", intgroup = "Group")
plotCounts(dds_2, gene="CGAGGGTGGCGTTTGGGGACT", intgroup = "Group")
plotCounts(dds_2, gene="ACTGAACAAGACGAACCAATGTGCAGGGCACT", intgroup = "Group")
plotCounts(dds_2, gene="AAGCTGGGCACTCTGGAGACACTGCCACC", intgroup = "Group")
plotCounts(dds_2, gene="GGCCCCATCGTATAGCGGCCTAGTACTCCGCCCT", intgroup = "Group")
plotCounts(dds_2, gene="GGCCCCATCGTATAGCGGCCTAGTACTCCGCCCT", intgroup = "Group", main="")
plotCounts(dds_2, gene="GAAGGGAGCTTGACTGCGAGACGG", intgroup = "Group", main="")
ggsave(filename = "/home/ultramind/Disco2/SARS_sRNA_paper/Review_npj/lfcShrink_tests/cuentas_sec_extrema.png")
plotCounts(dds_2, gene="GAAGGGAGCTTGACTGCGAGACGG", intgroup = "Group", main="")
ggsave(filename = "/home/ultramind/Disco2/SARS_sRNA_paper/Review_npj/lfcShrink_tests/cuentas_sec_extrema.png")
plotCounts(dds_2, gene="GAAGGGAGCTTGACTGCGAGACGG", intgroup = "Group", main="",
filename = "/home/ultramind/Disco2/SARS_sRNA_paper/Review_npj/lfcShrink_tests/cuentas_sec_extrema.png"
plotCounts(dds_2, gene="GAAGGGAGCTTGACTGCGAGACGG", intgroup = "Group", main="",
file = "/home/ultramind/Disco2/SARS_sRNA_paper/Review_npj/lfcShrink_tests/cuentas_sec_extrema.png"
plotCounts(dds_2, gene="GAAGGGAGCTTGACTGCGAGACGG", intgroup = "Group", main="",
file = "/home/ultramind/Disco2/SARS_sRNA_paper/Review_npj/lfcShrink_tests/cuentas_sec_extrema.png")
plotCounts(dds_2, gene="GAAGGGAGCTTGACTGCGAGACGG", intgroup = "Group", main="",
filename = "/home/ultramind/Disco2/SARS_sRNA_paper/Review_npj/lfcShrink_tests/cuentas_sec_extrema.png")
plotCounts(dds_2, gene="GAAGGGAGCTTGACTGCGAGACGG", intgroup = "Group", main="")
plotCounts(dds_2, gene="CGAGGGCTTTACT", intgroup = "Group", main="")
plotCounts(dds_2, gene="GTGTCAGTTCCCAGAGCTTTGGAAGA", intgroup = "Group", main="")
plotCounts(dds_2, gene="TCCCTGGTGGTCTAGTGGTTAGGATTCGGCGCG", intgroup = "Group")
plotCounts(dds_2, gene="CCTGGCTCAGGACGAACGCTGGC", intgroup = "Group")
plotCounts(dds_2, gene="CCTGGCTCAGGACGAACGCTGGC", intgroup = "Group")
plotCounts(dds_2, gene="TTTGGCAATGGTAGAACTCACA", intgroup = "Group")
# Check how many seqs have an strange trend of lfcShrink correction
DE_test_ann_shrink <- DE_test_ann[abs(DE_test_ann$log2FoldChange) < abs(DE_test_ann$lfcShrunk),] #6703
table(DE_test_ann_shrink$Class_toplot)
# Check if the sign of the LFCs is concordant
table(sign(DE_test_ann$log2FoldChange) == sign(DE_test_ann$lfcShrunk)) #413
DE_test_ann_sign <- DE_test_ann[sign(DE_test_ann$log2FoldChange) != sign(DE_test_ann$lfcShrunk),]
table(DE_test_ann_sign$Class_toplot)
# How many with really strange trends
DE_test_ann_shrink_ext <- DE_test_ann[2+abs(DE_test_ann$log2FoldChange) < abs(DE_test_ann$lfcShrunk),] #6703
table(DE_test_ann_shrink_ext$Class_toplot)
# Get sig sequences
DE_test_ann_sig <- DE_test_ann[DE_test_ann$padj < 0.05,]
# How many with strange trends
DE_test_ann_sig_shrink <- DE_test_ann_sig[abs(DE_test_ann_sig$log2FoldChange) < abs(DE_test_ann_sig$lfcShrunk),]
table(DE_test_ann_sig_shrink$Class_toplot)
# How many with really strange trends
DE_test_ann_sig_extreme <- DE_test_ann_sig[2+abs(DE_test_ann_sig$log2FoldChange) < abs(DE_test_ann_sig$lfcShrunk),]
table(DE_test_ann_sig_extreme$Class_toplot)
mean(DE_test_ann_shrink$baseMean)
counts_table_final <- read.table("/home/ultramind/Disco2/SARS_sRNA_paper/Reproducibility_test/Results/03-Fusion_tables/Filtered_abs-outer_filt5.tsv", sep="\t",
header=TRUE)
counts_table_final <- counts_table_final %>%
column_to_rownames(var="seq")
colnames(counts_table_final) <- gsub("\\.", "-", colnames(counts_table_final))
colnames(counts_table_final) <- gsub("T0_control", "C", colnames(counts_table_final))
colnames(counts_table_final) <- gsub("T1_acute", "A1", colnames(counts_table_final))
colnames(counts_table_final) <- gsub("T2_acute", "A2", colnames(counts_table_final))
colnames(counts_table_final) <- gsub("T1_mild", "B1", colnames(counts_table_final))
colnames(counts_table_final) <- gsub("T2_mild", "B2", colnames(counts_table_final))
sampletable <- read.table("/home/ultramind/Disco2/SARS_sRNA_paper/Reproducibility_test/Additional_data/samplesheet_test.tsv", header=T, sep="\t")
rownames(sampletable) <- sampletable$SampleName
dds <- DESeqDataSetFromMatrix(countData = counts_table_final,
colData = sampletable,
design = ~ Group)
counts_table_final <- read.table("/home/ultramind/Disco2/SARS_sRNA_paper/Reproducibility_test/Results/03-Fusion_tables/Filtered_abs-outer_filt5.tsv", sep="\t",
header=TRUE)
counts_table_final <- counts_table_final %>%
column_to_rownames(var="seq")
colnames(counts_table_final) <- gsub("\\.", "-", colnames(counts_table_final))
colnames(counts_table_final) <- gsub("T0_control", "C", colnames(counts_table_final))
colnames(counts_table_final) <- gsub("T1_acute", "A1", colnames(counts_table_final))
colnames(counts_table_final) <- gsub("T2_acute", "A2", colnames(counts_table_final))
colnames(counts_table_final) <- gsub("T1_mild", "B1", colnames(counts_table_final))
colnames(counts_table_final) <- gsub("T2_mild", "B2", colnames(counts_table_final))
sampletable <- read.table("/home/ultramind/Disco2/SARS_sRNA_paper/Reproducibility_test/Additional_data/samplesheet_test.tsv", header=T, sep="\t")
rownames(sampletable) <- sampletable$SampleName
dds <- DESeqDataSetFromMatrix(countData = counts_table_final,
colData = sampletable,
design = ~ Group)
dds$Group <- relevel(dds$Group, ref ="C")
dds_2 <- DESeq(dds)
#save(dds_2, file = "/path/to/DEA_results/DESeq_object.RData")
padj.cutoff <- 0.05
res_T1acute <- results(dds_2, name ="Group_A1_vs_C", lfcThreshold = 0.585, alpha=0.05)
shrunk_T1acute <- lfcShrink(dds_2, coef="Group_A1_vs_C", res=res_T1acute)
res_T1acute_tb <- res_T1acute %>%
data.frame() %>%
rownames_to_column(var="seq") %>%
as_tibble()
res_T1acute_tb$lfcShrunk <- shrunk_T1acute$log2FoldChange
res_T1acute_tb$lfcShrunkSE <- shrunk_T1acute$lfcSE
sigT1acute <- res_T1acute_tb %>%
dplyr::filter(padj < padj.cutoff)
#write.table(res_T1acute_tb, "/path/to/DEA_results/results_DE_T1acute.tsv", sep = "\t", quote = F, row.names = F)
padj.cutoff <- 0.05
res_test <- results(dds_2, name ="Group_A2_vs_C", lfcThreshold = 0.585, alpha=0.05)
shrunk_test <- lfcShrink(dds_2, coef="Group_A2_vs_C", res=res_test)
res_test_tb <- res_test %>%
data.frame() %>%
rownames_to_column(var="seq") %>%
as_tibble()
res_test_tb$lfcShrunk <- shrunk_test$log2FoldChange
res_test_tb$lfcShrunkSE <- shrunk_test$lfcSE
sigtest <- res_test_tb %>%
dplyr::filter(padj < padj.cutoff)
#write.table(res_T1acute_tb, "/path/to/DEA_results/results_DE_T1acute.tsv", sep = "\t", quote = F, row.names = F)
anno_file <- read.table("/home/ultramind/Disco2/SARS_sRNA_paper/Reproducibility_test/Results/06-Annotation/Annotation/curated_unitas_withtiny_annotation.tsv", sep="\t", header = TRUE)
cfg_file <- read.delim("/home/ultramind/Disco2/SARS_sRNA_paper/Reproducibility_test/Results/06-Annotation/Exogenous/centrifuge_anno_final.tsv", sep="\t", header=TRUE)
DE_test_ann <- merge(res_test_tb, anno_file, by.x = "seq", by.y = "Seq", all.x = TRUE)
DE_test_ann <- merge(DE_test_ann, cfg_file, by.x="seq", by.y="Seq", all.x=TRUE)
DE_test_ann$ID.x <- ifelse(is.na(DE_test_ann$ID.x), DE_test_ann$ID.y, DE_test_ann$ID.x)
DE_test_ann$ID.y <- NULL
names(DE_test_ann)[names(DE_test_ann) == 'ID.x'] <- 'ID'
DE_test_ann$RNA_class <- ifelse(!is.na(DE_test_ann$taxID), "Microorganism", DE_test_ann$RNA_class)
DE_test_ann$Class_toplot <- ifelse(is.na(DE_test_ann$RNA_class), "Other", DE_test_ann$RNA_class)
DE_test_ann$Class_toplot <- ifelse(grepl("miRNA-like|lncRNA|protein_coding|misc_RNA|rRNA|Mt_RNA|scaRNA", DE_test_ann$RNA_class), "Other", DE_test_ann$Class_toplot)
DE_test_ann$Class_toplot <- ifelse(grepl("piR-cluster", DE_test_ann$RNA_class), "piRNA", DE_test_ann$Class_toplot)
DE_test_ann$Class_toplot <- ifelse(DE_test_ann$padj < 0.05, DE_test_ann$Class_toplot, "Non-significant")
DE_test_ann$Class_toplot <- factor(DE_test_ann$Class_toplot, levels=c("miRNA", "tyRNA", "tRNA-derived", "snRNA", "snoRNA", "piRNA", "Microorganism", "Other", "Non-significant"))
# Check how many seqs have an strange trend of lfcShrink correction
DE_test_ann_shrink <- DE_test_ann[abs(DE_test_ann$log2FoldChange) < abs(DE_test_ann$lfcShrunk),] #6703
table(DE_test_ann_shrink$Class_toplot)
# Check if the sign of the LFCs is concordant
table(sign(DE_test_ann$log2FoldChange) == sign(DE_test_ann$lfcShrunk)) #413
DE_test_ann_sign <- DE_test_ann[sign(DE_test_ann$log2FoldChange) != sign(DE_test_ann$lfcShrunk),]
table(DE_test_ann_sign$Class_toplot)
# How many with really strange trends
DE_test_ann_shrink_ext <- DE_test_ann[2+abs(DE_test_ann$log2FoldChange) < abs(DE_test_ann$lfcShrunk),] #6703
table(DE_test_ann_shrink_ext$Class_toplot)
# Get sig sequences
DE_test_ann_sig <- DE_test_ann[DE_test_ann$padj < 0.05,]
# How many with strange trends
DE_test_ann_sig_shrink <- DE_test_ann_sig[abs(DE_test_ann_sig$log2FoldChange) < abs(DE_test_ann_sig$lfcShrunk),]
table(DE_test_ann_sig_shrink$Class_toplot)
# How many with really strange trends
DE_test_ann_sig_extreme <- DE_test_ann_sig[2+abs(DE_test_ann_sig$log2FoldChange) < abs(DE_test_ann_sig$lfcShrunk),]
table(DE_test_ann_sig_extreme$Class_toplot)
mean(DE_test_ann_shrink$baseMean)
hist(DE_test_ann_shrink$baseMean)
plotCounts(dds_2, gene="TTTGGCAATGGTAGAACTCACA", intgroup = "Group")
plotCounts(dds_2, gene="TTTGGCAATGGTAGAACTCACA", intgroup = "Group")
plotCounts(dds_2, gene="TTTGGCAATGGTAGAACTCACA", intgroup = "Group")
plotCounts(dds_2, gene="GTGTCAGTTCCCAGAGCTTTGGAAGA", intgroup = "Group", main="")
plotCounts(dds_2, gene="GAAGGGAGCTTGACTGCGAGACGG", intgroup = "Group", main="")
View(res_test_tb)
head(res_test)
head(shrunk_test)
table(res_test_tb$seq == rownames(shrunk_test))
res_test_tb$seq
head(res_test_tb$seq)
head(rownames(shrunk_test))
tail(res_test_tb$seq)
tail(rownames(shrunk_test))
plotCounts(dds_2, gene="AATGACACGATCACTCCCGTTGAGT", intgroup = "Group")
plotCounts(dds_2, gene="CAGAGTTCTACAGTCCGACGATT", intgroup = "Group")
plotCounts(dds_2, gene="AGTCCGACGATC", intgroup = "Group")
plotCounts(dds_2, gene="TCCCTGGTGGTCTAGTGGTTAGGATTCGGCGCG", intgroup = "Group", main="")
# Check how many seqs have an strange trend of lfcShrink correction
DE_test_ann_shrink <- DE_test_ann[abs(DE_test_ann$log2FoldChange) < abs(DE_test_ann$lfcShrunk),] #6703
table(DE_test_ann_shrink$Class_toplot)
# Check if the sign of the LFCs is concordant
#table(sign(DE_test_ann$log2FoldChange) == sign(DE_test_ann$lfcShrunk)) #413
#DE_test_ann_sign <- DE_test_ann[sign(DE_test_ann$log2FoldChange) != sign(DE_test_ann$lfcShrunk),]
#table(DE_test_ann_sign$Class_toplot)
# How many with really strange trends
DE_test_ann_shrink_ext <- DE_test_ann[2+abs(DE_test_ann$log2FoldChange) < abs(DE_test_ann$lfcShrunk),] #6703
table(DE_test_ann_shrink_ext$Class_toplot)
# Get sig sequences
DE_test_ann_sig <- DE_test_ann[DE_test_ann$padj < 0.05,]
# How many with strange trends
DE_test_ann_sig_shrink <- DE_test_ann_sig[abs(DE_test_ann_sig$log2FoldChange) < abs(DE_test_ann_sig$lfcShrunk),]
table(DE_test_ann_sig_shrink$Class_toplot)
# How many with really strange trends
DE_test_ann_sig_extreme <- DE_test_ann_sig[2+abs(DE_test_ann_sig$log2FoldChange) < abs(DE_test_ann_sig$lfcShrunk),]
table(DE_test_ann_sig_extreme$Class_toplot)
mean(DE_test_ann_shrink$baseMean)
plotCounts(dds_2, gene="TCCCTGTGGTCTAGTGGTTAGGATTCGGCGCG", intgroup = "Group")
plotCounts(dds_2, gene="TCCCTGTGGTCTAGTGGTTAGGATTCGGCGCG", intgroup = "Group", main="")
View(DE_test_ann)
plotCounts(dds_2, gene="TGAGGTAGTAGTTTGTGCTGTT", intgroup = "Group", main="")
plotCounts(dds_2, gene="TGAGGTAGTAGTTTGTACGGTT", intgroup = "Group", main="")
plotCounts(dds_2, gene="TGAGGTAGTAGGTTGTAGGGTT", intgroup = "Group", main="")
plotCounts(dds_2, gene="TGAGGTAGTAGGTTGTAGGGTT", intgroup = "Group", main="")
plotCounts(dds_2, gene="ACCAATATTACTGTGCTGCTTT", intgroup = "Group", main="")
plotCounts(dds_2, gene="TTTGGCAATGGTAGAACTCACACT", intgroup = "Group", main="")
plotCounts(dds_2, gene="TTTGGCAATGGTAGAACTCACA", intgroup = "Group", main="")
plotCounts(dds_2, gene="ATGGCACTGGTAGAATTCACTG", intgroup = "Group", main="")
plotCounts(dds_2, gene="TATGGCACTGGTAGAATTCACTG", intgroup = "Group", main="")
plotCounts(dds_2, gene="TCCTTCATTCCACCGGAGTCT", intgroup = "Group", main="")
plotCounts(dds_2, gene="TTGGGGAAACGGCCGCTGAGT", intgroup = "Group", main="")
plotMA(dds_2)
plotMA(dds_2, xlim=c(0,100000))
?plotMA
